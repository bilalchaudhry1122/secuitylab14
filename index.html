<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Access Control Testing Portal</title>
</head>
<body style="margin:0;padding:0;font-family:Arial,sans-serif;background:#1a1a2e;color:#eee;min-height:100vh">
    
    <div style="max-width:1400px;margin:0 auto;padding:20px">
        
        <div style="background:linear-gradient(45deg,#16213e,#0f3460);padding:40px;border-radius:8px;margin-bottom:30px;box-shadow:0 4px 20px rgba(0,0,0,0.3);text-align:center">
            <h1 style="margin:0;font-size:36px;color:#e94560;text-shadow:2px 2px 4px rgba(0,0,0,0.5)">Access Control Testing Portal</h1>
            <p style="margin:10px 0 0;font-size:18px;color:#a8a8a8">Role-Based Permission Verification System</p>
        </div>

        <div style="background:#16213e;padding:25px;border-radius:8px;margin-bottom:25px;border:2px solid #0f3460">
            <h2 style="margin:0 0 20px;color:#e94560;font-size:24px">üîë User Authentication</h2>
            <div style="display:flex;gap:15px;flex-wrap:wrap;align-items:end">
                <div style="flex:1;min-width:200px">
                    <label style="display:block;margin-bottom:8px;color:#a8a8a8;font-weight:bold">Select User Type:</label>
                    <select id="roleSelector" style="width:100%;padding:12px;border:2px solid #0f3460;border-radius:5px;background:#1a1a2e;color:#eee;font-size:16px">
                        <option value="student">Student Account</option>
                        <option value="teacher">Teacher Account</option>
                    </select>
                </div>
                <button onclick="performLogin()" style="padding:12px 30px;background:#e94560;color:white;border:none;border-radius:5px;font-size:16px;font-weight:bold;cursor:pointer;transition:all 0.3s" onmouseover="this.style.background='#d63447'" onmouseout="this.style.background='#e94560'">Authenticate</button>
                <button onclick="clearSession()" style="padding:12px 30px;background:#555;color:white;border:none;border-radius:5px;font-size:16px;font-weight:bold;cursor:pointer" onmouseover="this.style.background='#666'" onmouseout="this.style.background='#555'">Clear Session</button>
            </div>
            
            <div id="authStatus" style="margin-top:20px;padding:15px;background:#0f3460;border-radius:5px;display:none;border-left:4px solid #e94560">
                <div style="font-weight:bold;color:#e94560;margin-bottom:10px">Authentication Token:</div>
                <div id="tokenText" style="word-break:break-all;font-family:monospace;font-size:12px;color:#a8a8a8;background:#1a1a2e;padding:10px;border-radius:4px"></div>
                <div id="userInfo" style="margin-top:10px;color:#a8a8a8"></div>
            </div>
        </div>

        <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(350px,1fr));gap:20px;margin-bottom:25px">
            
            <div style="background:#16213e;padding:20px;border-radius:8px;border:2px solid #0f3460">
                <h2 style="margin:0 0 20px;color:#e94560;font-size:22px;border-bottom:2px solid #0f3460;padding-bottom:10px">üìö Student Capabilities</h2>
                
                <div style="margin-bottom:15px;padding:15px;background:#0f3460;border-radius:5px;border-left:4px solid #4ade80">
                    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px">
                        <h3 style="margin:0;color:#4ade80;font-size:16px">View Course List</h3>
                        <span style="background:#4ade80;color:#1a1a2e;padding:4px 10px;border-radius:12px;font-size:12px;font-weight:bold">PERMITTED</span>
                    </div>
                    <p style="margin:0 0 10px;color:#a8a8a8;font-size:14px">Access enrolled course information</p>
                    <button onclick="executeTest('student','viewCourses')" style="width:100%;padding:10px;background:#4ade80;color:#1a1a2e;border:none;border-radius:4px;font-weight:bold;cursor:pointer">Execute Test</button>
                    <div id="result-student-viewCourses" style="margin-top:10px;padding:10px;background:#1a1a2e;border-radius:4px;font-size:12px;font-family:monospace;display:none;color:#4ade80"></div>
                </div>

                <div style="margin-bottom:15px;padding:15px;background:#0f3460;border-radius:5px;border-left:4px solid #4ade80">
                    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px">
                        <h3 style="margin:0;color:#4ade80;font-size:16px">View Assignments</h3>
                        <span style="background:#4ade80;color:#1a1a2e;padding:4px 10px;border-radius:12px;font-size:12px;font-weight:bold">PERMITTED</span>
                    </div>
                    <p style="margin:0 0 10px;color:#a8a8a8;font-size:14px">Browse available assignments</p>
                    <button onclick="executeTest('student','viewAssignments')" style="width:100%;padding:10px;background:#4ade80;color:#1a1a2e;border:none;border-radius:4px;font-weight:bold;cursor:pointer">Execute Test</button>
                    <div id="result-student-viewAssignments" style="margin-top:10px;padding:10px;background:#1a1a2e;border-radius:4px;font-size:12px;font-family:monospace;display:none;color:#4ade80"></div>
                </div>

                <div style="margin-bottom:15px;padding:15px;background:#0f3460;border-radius:5px;border-left:4px solid:#4ade80">
                    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px">
                        <h3 style="margin:0;color:#4ade80;font-size:16px">Submit Assignment</h3>
                        <span style="background:#4ade80;color:#1a1a2e;padding:4px 10px;border-radius:12px;font-size:12px;font-weight:bold">PERMITTED</span>
                    </div>
                    <p style="margin:0 0 10px;color:#a8a8a8;font-size:14px">Upload assignment submission</p>
                    <button onclick="executeTest('student','submitAssignment')" style="width:100%;padding:10px;background:#4ade80;color:#1a1a2e;border:none;border-radius:4px;font-weight:bold;cursor:pointer">Execute Test</button>
                    <div id="result-student-submitAssignment" style="margin-top:10px;padding:10px;background:#1a1a2e;border-radius:4px;font-size:12px;font-family:monospace;display:none;color:#4ade80"></div>
                </div>

                <div style="margin-bottom:15px;padding:15px;background:#0f3460;border-radius:5px;border-left:4px solid:#4ade80">
                    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px">
                        <h3 style="margin:0;color:#4ade80;font-size:16px">View Personal Grades</h3>
                        <span style="background:#4ade80;color:#1a1a2e;padding:4px 10px;border-radius:12px;font-size:12px;font-weight:bold">PERMITTED</span>
                    </div>
                    <p style="margin:0 0 10px;color:#a8a8a8;font-size:14px">Check own grade records</p>
                    <button onclick="executeTest('student','viewGrades')" style="width:100%;padding:10px;background:#4ade80;color:#1a1a2e;border:none;border-radius:4px;font-weight:bold;cursor:pointer">Execute Test</button>
                    <div id="result-student-viewGrades" style="margin-top:10px;padding:10px;background:#1a1a2e;border-radius:4px;font-size:12px;font-family:monospace;display:none;color:#4ade80"></div>
                </div>

                <div style="margin-bottom:15px;padding:15px;background:#0f3460;border-radius:5px;border-left:4px solid:#f87171">
                    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px">
                        <h3 style="margin:0;color:#f87171;font-size:16px">Create Course</h3>
                        <span style="background:#f87171;color:#1a1a2e;padding:4px 10px;border-radius:12px;font-size:12px;font-weight:bold">RESTRICTED</span>
                    </div>
                    <p style="margin:0 0 10px;color:#a8a8a8;font-size:14px">Should return 403 Forbidden</p>
                    <button onclick="executeTest('student','createCourse')" style="width:100%;padding:10px;background:#f87171;color:white;border:none;border-radius:4px;font-weight:bold;cursor:pointer">Execute Test</button>
                    <div id="result-student-createCourse" style="margin-top:10px;padding:10px;background:#1a1a2e;border-radius:4px;font-size:12px;font-family:monospace;display:none;color:#f87171"></div>
                </div>

                <div style="margin-bottom:15px;padding:15px;background:#0f3460;border-radius:5px;border-left:4px solid:#f87171">
                    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px">
                        <h3 style="margin:0;color:#f87171;font-size:16px">Grade Assignments</h3>
                        <span style="background:#f87171;color:#1a1a2e;padding:4px 10px;border-radius:12px;font-size:12px;font-weight:bold">RESTRICTED</span>
                    </div>
                    <p style="margin:0 0 10px;color:#a8a8a8;font-size:14px">Should return 403 Forbidden</p>
                    <button onclick="executeTest('student','gradeAssignment')" style="width:100%;padding:10px;background:#f87171;color:white;border:none;border-radius:4px;font-weight:bold;cursor:pointer">Execute Test</button>
                    <div id="result-student-gradeAssignment" style="margin-top:10px;padding:10px;background:#1a1a2e;border-radius:4px;font-size:12px;font-family:monospace;display:none;color:#f87171"></div>
                </div>

            </div>

            <div style="background:#16213e;padding:20px;border-radius:8px;border:2px solid #0f3460">
                <h2 style="margin:0 0 20px;color:#e94560;font-size:22px;border-bottom:2px solid #0f3460;padding-bottom:10px">üë®‚Äçüè´ Teacher Capabilities</h2>
                
                <div style="margin-bottom:15px;padding:15px;background:#0f3460;border-radius:5px;border-left:4px solid:#4ade80">
                    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px">
                        <h3 style="margin:0;color:#4ade80;font-size:16px">Create Course</h3>
                        <span style="background:#4ade80;color:#1a1a2e;padding:4px 10px;border-radius:12px;font-size:12px;font-weight:bold">PERMITTED</span>
                    </div>
                    <p style="margin:0 0 10px;color:#a8a8a8;font-size:14px">Add new course to system</p>
                    <button onclick="executeTest('teacher','createCourse')" style="width:100%;padding:10px;background:#4ade80;color:#1a1a2e;border:none;border-radius:4px;font-weight:bold;cursor:pointer">Execute Test</button>
                    <div id="result-teacher-createCourse" style="margin-top:10px;padding:10px;background:#1a1a2e;border-radius:4px;font-size:12px;font-family:monospace;display:none;color:#4ade80"></div>
                </div>

                <div style="margin-bottom:15px;padding:15px;background:#0f3460;border-radius:5px;border-left:4px solid:#4ade80">
                    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px">
                        <h3 style="margin:0;color:#4ade80;font-size:16px">Create Assignment</h3>
                        <span style="background:#4ade80;color:#1a1a2e;padding:4px 10px;border-radius:12px;font-size:12px;font-weight:bold">PERMITTED</span>
                    </div>
                    <p style="margin:0 0 10px;color:#a8a8a8;font-size:14px">Create new assignment</p>
                    <button onclick="executeTest('teacher','createAssignment')" style="width:100%;padding:10px;background:#4ade80;color:#1a1a2e;border:none;border-radius:4px;font-weight:bold;cursor:pointer">Execute Test</button>
                    <div id="result-teacher-createAssignment" style="margin-top:10px;padding:10px;background:#1a1a2e;border-radius:4px;font-size:12px;font-family:monospace;display:none;color:#4ade80"></div>
                </div>

                <div style="margin-bottom:15px;padding:15px;background:#0f3460;border-radius:5px;border-left:4px solid:#4ade80">
                    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px">
                        <h3 style="margin:0;color:#4ade80;font-size:16px">View All Submissions</h3>
                        <span style="background:#4ade80;color:#1a1a2e;padding:4px 10px;border-radius:12px;font-size:12px;font-weight:bold">PERMITTED</span>
                    </div>
                    <p style="margin:0 0 10px;color:#a8a8a8;font-size:14px">Access all student submissions</p>
                    <button onclick="executeTest('teacher','viewAllSubmissions')" style="width:100%;padding:10px;background:#4ade80;color:#1a1a2e;border:none;border-radius:4px;font-weight:bold;cursor:pointer">Execute Test</button>
                    <div id="result-teacher-viewAllSubmissions" style="margin-top:10px;padding:10px;background:#1a1a2e;border-radius:4px;font-size:12px;font-family:monospace;display:none;color:#4ade80"></div>
                </div>

                <div style="margin-bottom:15px;padding:15px;background:#0f3460;border-radius:5px;border-left:4px solid:#4ade80">
                    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px">
                        <h3 style="margin:0;color:#4ade80;font-size:16px">Grade Submissions</h3>
                        <span style="background:#4ade80;color:#1a1a2e;padding:4px 10px;border-radius:12px;font-size:12px;font-weight:bold">PERMITTED</span>
                    </div>
                    <p style="margin:0 0 10px;color:#a8a8a8;font-size:14px">Evaluate and grade work</p>
                    <button onclick="executeTest('teacher','gradeSubmission')" style="width:100%;padding:10px;background:#4ade80;color:#1a1a2e;border:none;border-radius:4px;font-weight:bold;cursor:pointer">Execute Test</button>
                    <div id="result-teacher-gradeSubmission" style="margin-top:10px;padding:10px;background:#1a1a2e;border-radius:4px;font-size:12px;font-family:monospace;display:none;color:#4ade80"></div>
                </div>

                <div style="margin-bottom:15px;padding:15px;background:#0f3460;border-radius:5px;border-left:4px solid:#f87171">
                    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px">
                        <h3 style="margin:0;color:#f87171;font-size:16px">Submit Assignment</h3>
                        <span style="background:#f87171;color:#1a1a2e;padding:4px 10px;border-radius:12px;font-size:12px;font-weight:bold">RESTRICTED</span>
                    </div>
                    <p style="margin:0 0 10px;color:#a8a8a8;font-size:14px">Should return 403 Forbidden</p>
                    <button onclick="executeTest('teacher','submitAssignment')" style="width:100%;padding:10px;background:#f87171;color:white;border:none;border-radius:4px;font-weight:bold;cursor:pointer">Execute Test</button>
                    <div id="result-teacher-submitAssignment" style="margin-top:10px;padding:10px;background:#1a1a2e;border-radius:4px;font-size:12px;font-family:monospace;display:none;color:#f87171"></div>
                </div>

            </div>

        </div>

        <div style="background:#16213e;padding:20px;border-radius:8px;border:2px solid #0f3460">
            <h2 style="margin:0 0 20px;color:#e94560;font-size:22px;border-bottom:2px solid #0f3460;padding-bottom:10px">üîí Security Validation</h2>
            <div style="padding:15px;background:#0f3460;border-radius:5px;border-left:4px solid:#fbbf24">
                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px">
                    <h3 style="margin:0;color:#fbbf24;font-size:16px">Request Without Token</h3>
                    <span style="background:#fbbf24;color:#1a1a2e;padding:4px 10px;border-radius:12px;font-size:12px;font-weight:bold">EXPECTED: 401</span>
                </div>
                <p style="margin:0 0 10px;color:#a8a8a8;font-size:14px">Test authentication requirement</p>
                <button onclick="executeTest('none','noToken')" style="width:100%;padding:10px;background:#fbbf24;color:#1a1a2e;border:none;border-radius:4px;font-weight:bold;cursor:pointer">Execute Test</button>
                <div id="result-none-noToken" style="margin-top:10px;padding:10px;background:#1a1a2e;border-radius:4px;font-size:12px;font-family:monospace;display:none;color:#fbbf24"></div>
            </div>
        </div>

    </div>

    <script>
        const API_URL = 'http://localhost:3000';
        let authToken = null;
        let currentUserType = null;

        window.addEventListener('DOMContentLoaded', function() {
            const savedToken = localStorage.getItem('auth_token');
            const savedRole = localStorage.getItem('user_role');
            if (savedToken) {
                authToken = savedToken;
                currentUserType = savedRole;
                updateAuthDisplay();
            }
        });

        async function performLogin() {
            const selectedRole = document.getElementById('roleSelector').value;
            const userEmail = selectedRole === 'student' ? 'student@lms.com' : 'teacher@lms.com';
            const userPassword = '123';

            try {
                const response = await fetch(`${API_URL}/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email: userEmail, password: userPassword })
                });

                const result = await response.json();
                
                if (result.success && result.token) {
                    authToken = result.token;
                    currentUserType = selectedRole;
                    localStorage.setItem('auth_token', result.token);
                    localStorage.setItem('user_role', selectedRole);
                    updateAuthDisplay();
                    displayResult('authStatus', `Authentication successful! Token received.`, 'success');
                } else {
                    alert('Authentication failed: ' + (result.message || 'Unknown error'));
                }
            } catch (err) {
                alert('Error: ' + err.message);
            }
        }

        function clearSession() {
            authToken = null;
            currentUserType = null;
            localStorage.removeItem('auth_token');
            localStorage.removeItem('user_role');
            document.getElementById('authStatus').style.display = 'none';
        }

        function updateAuthDisplay() {
            if (authToken) {
                document.getElementById('tokenText').textContent = authToken;
                document.getElementById('userInfo').textContent = `Logged in as: ${currentUserType.toUpperCase()}`;
                document.getElementById('authStatus').style.display = 'block';
            }
        }

        function getAuthHeaders() {
            if (!authToken) {
                throw new Error('Please authenticate first');
            }
            return {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${authToken}`
            };
        }

        function displayResult(elementId, message, type) {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            element.textContent = message;
            const colors = {
                success: '#4ade80',
                error: '#f87171',
                warning: '#fbbf24'
            };
            element.style.color = colors[type] || '#a8a8a8';
        }

        async function executeTest(userType, testType) {
            if (userType !== 'none' && currentUserType !== userType) {
                alert(`Please login as ${userType} first`);
                return;
            }

            const resultId = `result-${userType}-${testType}`;
            
            try {
                let response, data;
                
                switch(testType) {
                    case 'viewCourses':
                        response = await fetch(`${API_URL}/courses`, {
                            method: 'GET',
                            headers: getAuthHeaders()
                        });
                        data = await response.json();
                        displayResult(resultId, `Status: ${response.status}\n${JSON.stringify(data, null, 2)}`, response.ok ? 'success' : 'error');
                        break;
                        
                    case 'viewAssignments':
                        response = await fetch(`${API_URL}/api/student/assignments`, {
                            method: 'GET',
                            headers: getAuthHeaders()
                        });
                        data = await response.json();
                        displayResult(resultId, `Status: ${response.status}\n${JSON.stringify(data, null, 2)}`, response.ok ? 'success' : 'error');
                        break;
                        
                    case 'submitAssignment':
                        response = await fetch(`${API_URL}/assignments/submit`, {
                            method: 'POST',
                            headers: getAuthHeaders(),
                            body: JSON.stringify({ assignmentId: 1, content: 'Test submission' })
                        });
                        data = await response.json();
                        displayResult(resultId, `Status: ${response.status}\n${JSON.stringify(data, null, 2)}`, response.ok ? 'success' : 'error');
                        break;
                        
                    case 'viewGrades':
                        response = await fetch(`${API_URL}/api/student/grades`, {
                            method: 'GET',
                            headers: getAuthHeaders()
                        });
                        data = await response.json();
                        displayResult(resultId, `Status: ${response.status}\n${JSON.stringify(data, null, 2)}`, response.ok ? 'success' : 'error');
                        break;
                        
                    case 'createCourse':
                        response = await fetch(`${API_URL}/courses`, {
                            method: 'POST',
                            headers: getAuthHeaders(),
                            body: JSON.stringify({ title: 'Test Course', description: 'Should fail for student' })
                        });
                        data = await response.json();
                        const isCorrect = (userType === 'student' && response.status === 403) || (userType === 'teacher' && response.ok);
                        displayResult(resultId, `Status: ${response.status}\n${JSON.stringify(data, null, 2)}`, isCorrect ? 'success' : 'error');
                        break;
                        
                    case 'gradeAssignment':
                        response = await fetch(`${API_URL}/api/teacher/submissions/1/grade`, {
                            method: 'POST',
                            headers: getAuthHeaders(),
                            body: JSON.stringify({ score: 100, feedback: 'Test' })
                        });
                        data = await response.json();
                        displayResult(resultId, `Status: ${response.status}\n${JSON.stringify(data, null, 2)}`, response.status === 403 ? 'success' : 'error');
                        break;
                        
                    case 'createAssignment':
                        response = await fetch(`${API_URL}/api/teacher/assignments`, {
                            method: 'POST',
                            headers: getAuthHeaders(),
                            body: JSON.stringify({ title: 'Test', description: 'Test', courseId: 1 })
                        });
                        data = await response.json();
                        displayResult(resultId, `Status: ${response.status}\n${JSON.stringify(data, null, 2)}`, response.ok ? 'success' : 'error');
                        break;
                        
                    case 'viewAllSubmissions':
                        response = await fetch(`${API_URL}/api/teacher/assignments/1/submissions`, {
                            method: 'GET',
                            headers: getAuthHeaders()
                        });
                        data = await response.json();
                        displayResult(resultId, `Status: ${response.status}\n${JSON.stringify(data, null, 2)}`, response.ok ? 'success' : 'error');
                        break;
                        
                    case 'gradeSubmission':
                        response = await fetch(`${API_URL}/api/teacher/submissions/1/grade`, {
                            method: 'POST',
                            headers: getAuthHeaders(),
                            body: JSON.stringify({ score: 85, feedback: 'Good work' })
                        });
                        data = await response.json();
                        displayResult(resultId, `Status: ${response.status}\n${JSON.stringify(data, null, 2)}`, response.ok ? 'success' : 'error');
                        break;
                        
                    case 'submitAssignment':
                        response = await fetch(`${API_URL}/assignments/submit`, {
                            method: 'POST',
                            headers: getAuthHeaders(),
                            body: JSON.stringify({ assignmentId: 1, content: 'Teacher submission' })
                        });
                        data = await response.json();
                        displayResult(resultId, `Status: ${response.status}\n${JSON.stringify(data, null, 2)}`, response.status === 403 ? 'success' : 'error');
                        break;
                        
                    case 'noToken':
                        const tempToken = authToken;
                        authToken = null;
                        response = await fetch(`${API_URL}/courses`, { method: 'GET' });
                        data = await response.json();
                        authToken = tempToken;
                        displayResult(resultId, `Status: ${response.status}\n${JSON.stringify(data, null, 2)}`, response.status === 401 ? 'success' : 'error');
                        break;
                }
            } catch (err) {
                displayResult(resultId, `Error: ${err.message}`, 'error');
            }
        }
    </script>

</body>
</html>
